#!/bin/sh
# Author : Stanley <git.io/monesonn>

# Script version
__version="0.1.0-rc3"

# General variables

# quiet mode is the default mode
# ISQUIET="-q --console-title"
IS_QUIET=""
VERBOSE=0

DIR=''
PARSE_QUALITY=''
YTDL_OUTPUT_TEMPLATE=''

YTDL_BIN=`which youtube-dl`
DEFAULT_DIR="$HOME/Music/yata"
PLAYLIST_DIR="${DEFAULT_DIR}/playlists"
UPLOADER_DIR="${DEFAULT_DIR}/uploader"

IS_PLAYLIST=''
YTDL_FORMAT='mp3'

# Some variables to initialize colors for colorfull echo output
BLUE='\033[1;34m'
RED='\033[31m'
CYAN='\033[1;36m'
NC='\033[0m'

_help() {
cat << EOF

 ▀▄▀ ▄▀▄ ▀█▀ ▄▀▄  
  █  █▀█  █  █▀█.sh                
EOF
echo -e "${BLUE} Ultimate audio download script${NC}"

cat << EOF

 Description: CLI-wrapper for youtube-dl written on Shell

 Usage: $(basename $0) [OPTIONS] -d [URL]

 Options:                       
  -h | --help | help            Show this message
  -v | --version | version      Show script version
  -p | --path | path            Set path [default: ~/Music/yata]
  -e | --extension | extension  Set file extension 
                                [mp3(default),best,aac,flac,m4a,opus,vorbis,wav]
  -p | --playlist | playlist    Flag for playlists 
  -q | --quality  | quality     .....
  -v | --verbose  | verbose     Turn off quiet mode
  -d | --download | download    Handle URL

 Example: yata download url
EOF
}

download() {
  $YTDL_BIN \
  ${IS_QUIET} \
  ${PARSE_QUALITY} \
  --continue \
  --ignore-errors \
  --extract-audio \
  --no-overwrites \
  --embed-thumbnail \
  --audio-format $YTDL_FORMAT \
  ${IS_PLAYLIST} \
  --output "${DIR}/${YTDL_OUTPUT_TEMPLATE}" \
  "$1"
  exit 1
}

err_msg() { echo -e "${RED}$1${NC}"; }

__main__() {
  while [[ "$#" -gt 0 ]]; do
    case $1 in
      -h | --help | help) _help && exit 1;;
      -v | --version | version) printf "$__version\n" && exit 1;;
      -p | --playlist | playlist) 
        DIR=$PLAYLIST_DIR
        IS_PLAYLIST='--yes-playlist'
        YTDL_OUTPUT_TEMPLATE='%(playlist)s/%(playlist_index)s - %(title)s.%(ext)s' ;;
      -e | --extension | extension) YTDL_FORMAT="$2" ;;
      -d | --download | download) download "$2" ;;
      # *) err_msg "No such option: $1" ; exit 1 ;;
    esac
    # case $* 
    #   err_msg "Input error, too many arguments.\nType yata [-h|--help|help] to see a list of all options." ; exit 1 ;;
    # esac
  shift
  done
}

if [[ ${#} -eq 0 ]]; then
  _help ; exit 1
fi
__main__ "$@" ; exit 0
