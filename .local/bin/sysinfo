#!/bin/sh

# vars
#FULL=▓
#EMPTY=░
FULL=━
#EMPTY=━
#EMPTY=─
#FULL=┅
EMPTY=┄

name=$USER
host=`hostname`
battery=/sys/class/power_supply/BAT1
distro=`uname -n`
kernel=`uname -r | sed 's/\-.*/ /'`
de=gnome
pkgs=`dnf list installed | wc -l`
shell=`echo $SHELL | awk -F "/" '{printf $NF}'`
font='terminus w/nerd'

# progress bar
draw()
{
  perc=$1
  size=$2
  inc=$(( perc * size / 100 ))
  out=
  if [ -z $3 ]
  then
    color="36"
  else
    color="$3"
  fi 
  for v in `seq 0 $(( size - 1 ))`; do
    test "$v" -le "$inc"   \
    && out="${out}\e[1;${color}m${FULL}" \
    || out="${out}\e[0;${color}m${EMPTY}"
  done
  printf $out
}

# colors
printf "\n  "
#i=0
#while [ $i -le 6 ]
#do
#  printf "\e[$((i+41))m\e[$((i+30))m█▓▒░"
#  i=$(($i+1))
#done
#printf "\e[37m█\e[0m▒░\n\n"


# greets
printf " \e[0m  usr \e[32m$name\033[0m, host \e[1;32m$host\n"
printf " \e[0m\n"

# environment
printf " \e[1;34m      distro \e[0m$distro\n"
printf " \e[1;34m      kernel \e[0m$kernel\n"
printf " \e[1;34m    packages \e[0m$pkgs\n"
printf " \e[1;34m          de \e[0m$de\n"
printf " \e[1;34m       shell \e[0m$shell\n"
printf " \e[1;34m        font \e[0m$font\n"
printf " \e[0m\n"

# cpu
cpu=$(grep 'cpu ' /proc/stat | awk '{usage=($2+$4)*100/($2+$4+$5)} END {print usage}')
c_lvl=`printf "%.0f" $cpu`
printf "   \e[0;36m%-4s \e[1;36m%-5s %-25s \n" " cpu" "$c_lvl%" `draw $c_lvl 15` 

# ram
ram=`free | awk '/Mem:/ {print int($3/$2 * 100.0)}'`
printf "   \e[0;36m%-4s \e[1;36m%-5s %-25s \n" " ram" "$ram%" `draw $ram 15` 

# battery
b_full=$battery/energy_full
b_now=$battery/energy_now
bf=`cat $b_full`
bn=`cat $b_now`
charge=`printf $(( 100 * $bn / $bf ))`

case 1 in
  $(($charge <= 15)))
    color='31'
    ;;
  *)
    color='36'
    ;;
esac
printf "   \e[0;${color}m%-4s \e[1;${color}m%-5s %-25s \n" " bat" "$charge%" `draw $charge 15 $color`

# volume
vol=`amixer get Master | awk '$0~/%/{print $5}' | tr -d '[]%' | head -1`
if amixer get Master | grep -q '\[off\]' 
then
  color='31'
else
  color='36'
fi
printf "   \e[0;${color}m%-4s \e[1;${color}m%-5s %-25s \n" " vol" "$vol%" `draw $vol 15 $color` 

brightness=`light -G | sed 's/\..*//'`
printf "   \e[0;36m%-4s \e[1;36m%-5s %-25s \n" " bgh" "$brightness%" `draw $brightness 15`

freespace=$((100-`df --output=pcent /home | tr -dc '0-9'`))
case 1 in 
    $(($freespace <= 15)))
        color='31'
        ;;
    *)
        color='36'
        ;;
esac
#printf "   \e[0;${color}m%-4s \e[1;${color}m%-5s %-25s \n" " frs" "$freespace%" `draw $freespace 15 $color`

printf "\n\n"
